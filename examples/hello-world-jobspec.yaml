version: 1
requires:
  io.archspec:
    cpu.target: amd64

tasks:
- name: build
  command: ["spack", "install", "ior"]  
  resources:
  - count: 4
    type: node
    with:
     - count: 1
       with:
       - count: 4
         type: core

- name: ior
  depends_on: ["build"]
  resources:
  - count: 4
    type: node
    with:
    - count: 1
      label: ior
      with:
      - count: 4
        type: core

    # This is an example of a custom "task-level' requires
    requires:
      hardware.gpu.available: "yes"

    command:
      - bash
      - -c
      - |
        spack load ior
        ior -b 10g -O summaryFormat=json
